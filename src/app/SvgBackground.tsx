"use client";
import React, { useRef } from "react";
import gsap from "gsap";
import { MotionPathPlugin } from "gsap/MotionPathPlugin";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import { useGSAP } from "@gsap/react";

// Register GSAP plugins
gsap.registerPlugin(MotionPathPlugin, ScrollTrigger);

export const SvgBackground: React.FC = () => {
  const riverRef = useRef<SVGSVGElement>(null);
  const boatRef = useRef<HTMLDivElement>(null);
  const motionPathRef = useRef<SVGPathElement>(null);

  useGSAP(() => {
    if (!riverRef.current || !boatRef.current || !motionPathRef.current) return;

    // Set initial state
    gsap.set(boatRef.current, {
      transformOrigin: "50% 50%",
      scale: 0.8,
      autoAlpha: 1,
    });

    // Wait for the next frame to ensure DOM is ready
    gsap.delayedCall(0.1, () => {
      // Create timeline for the boat animation
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: riverRef.current, // Use the SVG container as trigger
          start: "top top",
          end: "bottom bottom",
          scrub: 1, // Smoother scrubbing
          refreshPriority: -1,
          onUpdate: (self) => {
            // console.log(`Progress: ${self.progress.toFixed(3)}`);
          },
        },
      });

      if (motionPathRef.current)
        // Animate boat along the river path with simplified settings
        tl.to(boatRef.current, {
          duration: 1,
          ease: "none", // Remove custom easing that might cause deviation
          immediateRender: true,
          motionPath: {
            path: motionPathRef.current,
            align: motionPathRef.current,
            alignOrigin: [0.5, 0.5],
            autoRotate: true, // Fixed rotation offset instead of dynamic rotation
            start: 0,
            end: 1,
          },
        });
    });

    // Cleanup function
    return () => {
      ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
    };
  }, []);

  return (
    <>
      {/* River SVG Background */}
      <svg
        ref={riverRef}
        width="100%"
        height="100%"
        viewBox="0 0 1440 9274"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        preserveAspectRatio="xMidYMid meet" // Changed from "none" to maintain aspect ratio
        style={{
          position: "absolute",
          top: 0,
          left: 0,
          width: "100vw",
          height: "auto", // Changed from 100% to auto
          minHeight: "100vh",
          zIndex: -1,
          pointerEvents: "none",
        }}
      >
        <path
          ref={motionPathRef}
          id="motionPath"
          d="M133.599,-1.66016C177.019,201.23 671.829,108.51 869.169,212.01C965.509,268.96 1013.8,391.82 967.919,495.84C877.359,669.63 578.039,516.93 542.779,740.32C510.929,954.68 693.229,1048.51 878.559,1006.79C1076.16,981.82 1316.42,845.22 1481.46,1019.4C1482.94,1020.97 1485.88,1024.14 1487.24,1025.82C1537.65,1087.79 1531.18,1171.64 1520.76,1262.5C1509.04,1364.71 1599.87,1421.84 1548.76,1505.5C1513.4,1563.37 1457.58,1625.79 1376.68,1627.75C1267.86,1630.38 1154.13,1588.11 1049.12,1558.54C912.189,1519.98 771.219,1531.08 657.139,1597.79C557.229,1656.21 525.099,1799.31 597.749,1889.5C668.169,1976.93 753.659,2000.88 865.749,2002.5C980.669,2004.17 1091.77,1941.58 1211.67,1934.27C1322.75,1927.5 1441.84,1967.95 1481.45,2131.53C1533.75,2347.5 1305.57,2421.68 1084.75,2501.5C975.239,2541.09 854.099,2725.51 762.749,2790.5C594.529,2915.06 316.749,2757.5 205.749,2935.5C112.309,3085.33 146.889,3318.84 296.749,3416.5C425.969,3500.71 608.489,3415.58 733.749,3386.5C901.749,3347.5 1091.75,3483.5 1012.75,3705.5C970.969,3822.9 806.529,3872.06 723.139,3933.81C689.509,3958.71 634.679,3999.48 611.299,4040.2C571.339,4109.77 606.329,4197.7 689.509,4219.45C794.929,4247.02 910.289,4222.65 1015.85,4204.68C1101.83,4190.04 1240.98,4183.79 1311.91,4197.47C1380.57,4207.83 1446.56,4218.27 1498.99,4279.2C1592.7,4388.1 1591.76,4568.08 1486.21,4645.67C1340.08,4753.09 1111.77,4613.5 940.739,4597.5C801.739,4584.5 702.739,4645.5 670.739,4754.5C634.879,4876.65 792.159,4997.11 808.889,5102.21C833.889,5177.21 773.939,5257.97 706.929,5287.56C582.359,5337.78 441.569,5246.53 310.739,5208.5C52.7394,5133.5 -71.3806,5236.72 -154.261,5305.5C-348.261,5466.5 -290.411,5879.84 -143.541,6060.33C9.5894,6218.8 201.949,6096.56 374.739,6044.5C501.759,6012.04 689.429,5997.47 804.739,6048.5C981.079,6117 1100.03,6294.89 1068.74,6494.5C1034.4,6713.56 870.359,6828.92 654.809,6823.78C181.739,6812.5 -18.6306,7040.65 -93.7106,7146.91C-286.701,7420.05 -160.261,8033.5 151.739,8169.5C462.009,8304.75 1327.74,8192.5 1158.73,8793.85C1046.36,9193.69 57.2894,8739.52 38.0294,9271.51"
          stroke="#89B9FF"
          strokeWidth="1"
          strokeDasharray="12 10"
          strokeLinecap="round"
        />
      </svg>

      {/* Boat Element - positioned to follow the river */}
      <div
        ref={boatRef}
        style={{
          position: "absolute",
          width: "56px",
          height: "55px",
          zIndex: 0,
          transformOrigin: "center center",
          top: 0,
          left: 0,
        }}
      >
        {/* Boat SVG with proper orientation */}
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="56"
          height="55"
          viewBox="0 0 56 55"
          fill="none"
        >
          <g id="boat">
            <g id="boat_shadow">
              <path
                opacity="0.1"
                d="M29.9425 46.4495L30.5762 41.3C30.6551 40.6748 30.563 40.0296 30.3106 39.4474L29.9146 38.5383L30.6122 31.6409C31.0448 31.5342 31.3731 31.2726 31.5131 30.9553C33.5813 30.9229 35.8398 30.7985 38.2831 30.5405C43.3589 30.0211 48.2877 28.5309 51.1713 27.5756C54.055 26.6202 54.46 26.3655 54.7315 25.9259C54.8704 25.6973 54.9117 25.237 54.9167 24.853C54.922 24.4395 54.8821 23.8718 54.7202 23.598C54.4601 23.1515 54.0439 22.898 51.1732 21.9393C48.2967 20.9688 43.3768 19.4755 38.3029 18.9374C36.0137 18.6952 33.9002 18.5734 31.9394 18.5245L32.766 10.3171C33.1339 10.1978 33.7629 9.98139 34.0974 9.70212C34.5991 9.28321 34.8778 3.24882 34.8778 3.24882C34.8778 3.24882 34.7814 2.01871 33.8715 1.56387C33.6425 1.45457 33.4243 1.42812 33.2348 1.46113C33.0453 1.49413 32.8788 1.57469 32.7358 1.67328C32.5927 1.77187 32.4849 1.88273 32.4071 1.96444C32.3292 2.04615 32.287 2.1106 32.287 2.1106L31.6534 7.26011C31.6139 7.57273 31.6216 7.89186 31.6589 8.21138C31.708 8.52513 31.7928 8.82163 31.919 9.11275L32.2401 9.86721L31.3993 18.2576C31.1607 17.9768 30.7556 17.7766 30.283 17.7705C29.6686 17.7744 29.1742 18.0871 29.0031 18.522C29.1036 18.5174 29.2041 18.5128 29.2927 18.514C29.4557 18.2443 29.8362 18.0601 30.2735 18.054C30.7107 18.0478 31.0805 18.2357 31.2543 18.5038C29.1278 18.4764 27.195 18.546 25.4915 18.6953C22.0609 19.0055 15.5283 19.7897 9.95977 21.8684L6.67574 23.179C6.67574 23.179 5.61251 23.6202 5.6172 24.6305C5.62295 24.6424 5.63446 24.6662 5.64022 24.6781C5.64597 24.6899 5.62794 24.7133 5.62181 24.731C5.62036 25.759 6.68405 26.1981 6.68405 26.1981L9.9637 27.5165C15.5376 29.6031 22.0553 30.4257 25.4899 30.7299C26.8884 30.8602 28.4472 30.9276 30.1426 30.9436L30.1016 31.3743C29.7418 31.3283 29.4426 31.1649 29.3037 30.9387C29.2032 30.9433 29.1089 30.9302 29.0084 30.9348C29.163 31.3149 29.5612 31.5919 30.0802 31.6635L29.4217 38.2779C29.1191 38.3804 28.7095 38.5346 28.388 38.7195C28.3048 38.7598 28.2331 38.8239 28.1794 38.8645C28.1138 38.9109 28.0528 39.0578 28.003 39.2581C27.9781 39.3582 27.947 39.4759 27.9217 39.6056C27.7384 40.5308 27.6058 42.1065 27.5185 43.3815C27.4396 44.4617 27.4109 45.3121 27.4109 45.3121C27.4109 45.3121 27.4719 46.075 27.9553 46.6188C28.0834 46.7623 28.2353 46.8942 28.4171 46.997C29.327 47.4518 30.0016 46.4503 30.0016 46.4503L29.9425 46.4495ZM7.31 25.763C6.77338 25.6852 6.35371 25.2426 6.36095 24.6814C6.3563 24.126 6.77551 23.6883 7.31404 23.6185C7.26686 23.612 7.21392 23.5936 7.16674 23.587C7.22581 23.5878 7.27875 23.6062 7.33168 23.6246C7.14453 23.9353 7.02757 24.3001 7.02837 24.696C7.02917 25.0918 7.14274 25.4478 7.32765 25.7692C7.32765 25.7692 7.32764 25.7692 7.31575 25.7749L7.31 25.763ZM27.0264 30.6907L27.0606 30.3366C27.2378 30.3389 27.415 30.3412 27.5864 30.3316C27.4779 30.5015 27.2696 30.617 27.0264 30.6907Z"
                fill="#F36F0D"
              />
            </g>

            <g id="boat_body">
              <path
                d="M34.3447 37.1752C39.4204 36.6557 44.3492 35.1655 47.2328 34.2102C50.1165 33.2549 50.5215 33.0001 50.793 32.5605C50.9319 32.3319 50.9733 31.8716 50.9782 31.4877C50.9835 31.0742 50.9436 30.5065 50.7817 30.2326C50.5216 29.7862 50.1054 29.5327 47.2347 28.574C44.3582 27.6034 39.4383 26.1102 34.3644 25.5721C29.2904 25.034 24.9718 25.0255 21.5412 25.3357C18.1105 25.6459 11.5779 26.4301 6.0094 28.5088L2.72536 29.8194C2.72536 29.8194 1.66213 30.2606 1.65493 31.2766C1.66069 31.2885 1.6722 31.3123 1.67795 31.3242C1.6837 31.3361 1.66568 31.3595 1.65954 31.3771C1.65809 32.4051 2.72178 32.8442 2.72178 32.8442L6.00144 34.1627C11.5753 36.2492 18.0931 37.0718 21.5276 37.3761C24.9679 37.6922 29.2689 37.6946 34.3566 37.1694L34.3447 37.1752ZM3.37151 32.3977C2.83489 32.3199 2.41522 31.8773 2.42246 31.3161C2.41781 30.7607 2.83702 30.323 3.37555 30.2531C3.32837 30.2466 3.27544 30.2282 3.22826 30.2217C3.28733 30.2224 3.34026 30.2409 3.3932 30.2593C3.20604 30.57 3.08908 30.9348 3.08988 31.3306C3.09068 31.7265 3.20425 32.0824 3.38916 32.4038C3.33584 32.4149 3.28828 32.438 3.22921 32.4372C3.28828 32.438 3.32395 32.4207 3.37727 32.4096L3.37151 32.3977Z"
                fill="#F36F0D"
              />

              <path
                d="M34.9221 36.3371C38.4303 35.9748 38.114 33.0167 38.114 33.0167L38.1169 31.8705L38.1238 30.884L38.1267 29.7379C38.1267 29.7379 38.4544 26.7763 34.9439 26.406C31.4335 26.0358 28.8332 25.636 24.8252 25.8147C20.8173 25.9934 15.745 26.7019 15.745 26.7019L14.1156 27.0649C14.1156 27.0649 12.3769 27.202 12.3747 29.1988C12.3794 29.2993 12.3721 29.4056 12.3824 29.518C12.3818 31.3967 12.3766 33.1749 12.3766 33.1749C12.3812 33.2754 12.3739 33.3817 12.3843 33.4941C12.3764 35.4791 14.1232 35.6316 14.1232 35.6316L15.7492 35.9893C15.7492 35.9893 20.8148 36.7223 24.8239 36.9099C28.833 37.0975 31.4317 36.7057 34.9398 36.3433L34.9221 36.3371ZM24.8549 36.3372C21.2531 36.1726 16.7066 35.5113 16.7066 35.5113L15.2455 35.1911C15.2455 35.1911 13.6874 35.0647 13.6869 33.2746C13.6881 33.186 13.6834 33.0855 13.6846 32.9969C13.6846 32.9969 13.6875 31.3958 13.6916 29.7062C13.6927 29.6176 13.6881 29.5171 13.6893 29.4285C13.6887 27.6383 15.2441 27.5166 15.2441 27.5166L16.7017 27.1928C16.7017 27.1928 21.2473 26.5484 24.8533 26.3881C28.4592 26.2279 30.7941 26.5947 33.9448 26.919C37.0955 27.2432 36.8011 29.9098 36.8011 29.9098L36.7997 30.9378L36.8001 31.8181L36.7987 32.8461C36.7987 32.8461 37.0893 35.5084 33.9421 35.8282C30.7949 36.148 28.4567 36.5019 24.8549 36.3372Z"
                fill="white"
              />

              <path
                d="M32.7568 35.2275C35.484 34.9496 35.2241 32.6539 35.2241 32.6539L35.2179 31.7618L35.2159 30.9996L35.2097 30.1074C35.2097 30.1074 35.4638 27.8125 32.7439 27.5292C30.0239 27.246 28.0075 26.9305 24.8921 27.0734C21.7767 27.2164 17.8467 27.7683 17.8467 27.7683L16.5848 28.0415C16.5848 28.0415 15.2423 28.1483 15.2401 29.6902C15.239 29.7788 15.2439 29.8498 15.2428 29.9384C15.2418 31.3918 15.2358 32.7742 15.2358 32.7742C15.2346 32.8628 15.2396 32.9337 15.2385 33.0223C15.2363 34.5643 16.5819 34.6762 16.5819 34.6762L17.8485 34.9584C17.8485 34.9584 21.7759 35.5231 24.8875 35.6755C27.999 35.8279 30.0177 35.5112 32.7449 35.2333L32.7568 35.2275Z"
                fill="white"
              />
            </g>

            <g id="boat_details">
              <path
                d="M15.28 33.138C15.2884 33.3981 15.3506 33.6175 15.425 33.8016L35.0275 33.8241C35.131 33.5832 35.187 33.3653 35.2073 33.1647L15.28 33.138Z"
                fill="#F36F0D"
              />
              <path
                d="M15.4267 28.8964C15.3535 29.0786 15.2975 29.2965 15.2764 29.5562L35.2038 29.5829C35.1827 29.3876 35.1324 29.1625 35.0173 28.9247L15.4148 28.9022L15.4267 28.8964Z"
                fill="#F36F0D"
              />
              <path
                d="M25.3374 25.1431C25.5004 24.8735 25.8808 24.6893 26.3181 24.6832C26.7554 24.677 27.1252 24.8649 27.299 25.133C27.3994 25.1284 27.5057 25.1357 27.5943 25.1368C27.4167 24.7091 26.9303 24.4016 26.31 24.3936C25.6956 24.3974 25.2012 24.7101 25.0301 25.1451C25.1306 25.1405 25.2311 25.1359 25.3197 25.137L25.3374 25.1431Z"
                fill="#F36F0D"
              />
              <path
                d="M25.3228 37.5771C25.4847 37.851 25.8663 38.0331 26.3094 38.0388C26.7466 38.0327 27.1152 37.8543 27.284 37.5965C27.3845 37.5919 27.485 37.5873 27.5912 37.5946C27.4144 38.0177 26.92 38.3303 26.3055 38.3342C25.6911 38.3381 25.1932 38.0067 25.0332 37.5852C25.1337 37.5806 25.228 37.5936 25.3285 37.589L25.3228 37.5771Z"
                fill="#F36F0D"
              />
            </g>

            <g id="boat_mast">
              <path
                d="M26.013 53.0987C26.013 53.0987 25.3327 54.0884 24.4285 53.6454C23.5187 53.1906 23.4223 51.9605 23.4223 51.9605C23.4223 51.9605 23.701 45.9261 24.2027 45.5072C24.7044 45.0883 25.8366 44.7897 25.8366 44.7897L26.4048 46.085C26.6573 46.6673 26.7494 47.3124 26.6704 47.9377L26.0368 53.0872L26.013 53.0987Z"
                fill="#F36F0D"
              />
              <path
                d="M23.5828 52.1724C23.5828 52.1724 23.8616 46.138 24.3632 45.7191C24.7932 45.3643 25.6888 45.0922 25.9378 45.0304L25.8284 44.8045C25.8284 44.8045 24.708 45.0973 24.2063 45.5162C23.7047 45.9351 23.4259 51.9695 23.4259 51.9695C23.4259 51.9695 23.487 52.7324 23.9703 53.2763C23.6462 52.7581 23.5886 52.1843 23.5886 52.1843L23.5828 52.1724Z"
                fill="black"
              />
              <path
                d="M26.426 35.7274C26.5672 35.7765 26.744 35.8083 26.9327 35.8344L28.8861 16.31C28.9061 16.1389 28.7837 16.0073 28.6303 15.9936C28.4768 15.9798 28.3276 16.096 28.3139 16.2494L26.3612 35.7148C26.3612 35.7148 26.4026 35.7094 26.426 35.7274Z"
                fill="#F36F0D"
              />
              <path
                d="M25.9889 45.2579L26.796 37.1921C26.5896 37.1599 26.3952 37.1219 26.2187 37.0606L25.4047 45.2031C25.4047 45.2031 25.4105 45.215 25.4043 45.2327C25.4024 45.3803 25.519 45.5 25.6606 45.5196C25.814 45.5334 25.9632 45.4171 25.977 45.2637L25.9889 45.2579Z"
                fill="#F36F0D"
              />
              <path
                d="M28.3336 8.7407C28.3336 8.7407 29.014 7.75103 29.9181 8.19398C30.828 8.64882 30.9243 9.87893 30.9243 9.87893C30.9243 9.87893 30.6456 15.9133 30.1439 16.3322C29.6422 16.7511 28.51 17.0496 28.51 17.0496L27.9418 15.7544C27.6893 15.1721 27.5972 14.527 27.6762 13.9017L28.3098 8.75221L28.3336 8.7407Z"
                fill="#F36F0D"
              />
              <path
                d="M28.2281 15.9524C27.9757 15.3701 27.8836 14.725 27.9625 14.0997L28.5961 8.9502C28.5961 8.9502 29.2765 7.96053 30.1806 8.40348C30.2217 8.42764 30.2508 8.45755 30.2861 8.46983C30.1752 8.36205 30.0525 8.26003 29.8998 8.18716C28.99 7.73232 28.3153 8.73389 28.3153 8.73389L27.6817 13.8834C27.6028 14.5086 27.6949 15.1538 27.9473 15.736L28.5155 17.0313C28.5155 17.0313 28.5749 17.0025 28.6816 16.9803L28.2342 15.9347L28.2281 15.9524Z"
                fill="black"
              />
            </g>
          </g>
        </svg>
      </div>
    </>
  );
};
